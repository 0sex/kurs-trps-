# Структура проекта "Программная система поиска аналогов лекарственных препаратов"

## Описание структуры

Проект реализован с использованием модульной архитектуры MVC/MVP. Все модули разделены по функциональности, что обеспечивает легкость поддержки и расширения.

## Дерево файлов

```
Kurs/
├── main.py                 # Точка входа в приложение
├── database.py             # Модуль работы с базой данных
├── search_engine.py        # Логика поиска аналогов
├── ui_main.py              # Графический интерфейс (PyQt5)
├── tests/                  # Тесты
│   ├── __init__.py
│   ├── test_database.py
│   └── test_search_engine.py
├── requirements.txt        # Зависимости Python
├── README.md              # Основная документация
├── PROJECT_STRUCTURE.md   # Этот файл
└── .gitignore            # Игнорируемые файлы Git

Служебные файлы (создаются автоматически):
├── drugs.db              # SQLite база данных
└── __pycache__/         # Python кэш
```

## Модули и их назначение

### 1. main.py
**Назначение**: Точка входа в приложение  
**Функции**:
- Запуск приложения
- Импорт и вызов основного GUI

**Использование**: `python main.py`

### 2. database.py
**Назначение**: Работа с SQLite базой данных  
**Класс**: `Database`

**Основные методы**:
- `add_drug()` - добавить препарат
- `get_drug_by_id()` - получить препарат по ID
- `get_drugs_by_substance()` - получить препараты по веществу
- `search_drugs_by_name()` - поиск по названию
- `update_drug()` - обновить препарат
- `delete_drug()` - удалить препарат
- `get_drugs_by_filters()` - фильтрация по критериям
- `add_analog_link()` - добавить связь между аналогами
- `get_analogs()` - получить аналоги препарата
- `populate_sample_data()` - заполнить демо-данными

### 3. search_engine.py
**Назначение**: Поиск аналогов препаратов  
**Класс**: `SearchEngine`

**Основные методы**:
- `find_analogs()` - найти аналоги по названию
- `find_analogs_by_id()` - найти аналоги по ID
- `search_with_filters()` - поиск с фильтрами
- `compare_drugs()` - сравнить препараты
- `_calculate_similarity()` - рассчитать сходство

**Алгоритм поиска**:
1. По действующему веществу (обязательно)
2. Учет формы выпуска (+0.3)
3. Учет производителя (+0.2)
4. Учет близости цены (+0.1-0.2)

### 4. ui_main.py
**Назначение**: Графический интерфейс (PyQt5)  
**Классы**:
- `MainWindow` - главное окно
- `AddDrugDialog` - диалог добавления/редактирования
- `ComparisonDialog` - диалог сравнения

**Компоненты интерфейса**:
- Поле поиска
- Фильтры (форма, производитель, цена)
- Таблица результатов
- Кнопки экспорта и сравнения
- Меню (Файл, Справка)

**Основные функции**:
- `search_analogs()` - поиск и отображение
- `display_results()` - вывод результатов
- `compare_selected()` - сравнение препаратов
- `export_to_csv()` - экспорт в CSV
- `export_to_json()` - экспорт в JSON
- `add_drug()` - добавить препарат
- `edit_drug()` - редактировать препарат
- `delete_drug()` - удалить препарат

### 5. tests/

#### test_search_engine.py
**Назначение**: Тесты поиска и базы данных

**Тестовые классы**:
- `TestSearchEngine` - тесты поиска аналогов
- `TestDatabase` - тесты базы данных

**Покрытие**:
- Поиск аналогов по названию и ID
- Фильтрация по форме, производителю, цене
- Сравнение препаратов
- CRUD операции с БД
- Обработка граничных случаев

#### test_database.py
**Назначение**: Расширенные тесты БД

**Тестовые классы**:
- `TestDatabaseAdvanced`

**Покрытие**:
- Связи между аналогами
- Сложные фильтры
- Диапазоны цен
- Специальные символы
- Регистронезависимый поиск
- Десятичные значения

## База данных

### Таблица `drugs`
```sql
CREATE TABLE drugs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    substance TEXT NOT NULL,
    form TEXT NOT NULL,
    manufacturer TEXT NOT NULL,
    price REAL NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

**Индексы**:
- `idx_substance` на поле `substance`
- `idx_name` на поле `name`

### Таблица `analog_links`
```sql
CREATE TABLE analog_links (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    drug_id INTEGER NOT NULL,
    analog_id INTEGER NOT NULL,
    similarity_score REAL DEFAULT 1.0,
    FOREIGN KEY (drug_id) REFERENCES drugs(id),
    FOREIGN KEY (analog_id) REFERENCES drugs(id),
    UNIQUE(drug_id, analog_id)
)
```

## Потоки данных

### Поиск аналогов

```
Пользователь вводит название
        ↓
ui_main.py: search_analogs()
        ↓
search_engine.py: find_analogs()
        ↓
database.py: search_drugs_by_name() + get_drugs_by_substance()
        ↓
search_engine.py: _calculate_similarity()
        ↓
ui_main.py: display_results()
        ↓
Отображение в таблице
```

### Добавление препарата

```
Пользователь: Файл → Добавить препарат
        ↓
ui_main.py: AddDrugDialog
        ↓
database.py: add_drug()
        ↓
database.py: populate_sample_data() (при первом запуске)
        ↓
ui_main.py: обновление фильтров
```

### Экспорт

```
Пользователь: кнопка экспорта
        ↓
ui_main.py: export_to_csv/json()
        ↓
Чтение данных из таблицы
        ↓
Запись в файл (CSV/JSON)
```

## Зависимости

### Python пакеты
- `PyQt5` (5.15.10) - GUI фреймворк
- `sqlite3` - встроенный в Python

### Запуск
```bash
pip install -r requirements.txt
python main.py
```

## Особенности реализации

### 1. Модульность
- Отдельные модули для БД, поиска, UI
- Легкое тестирование каждого компонента
- Возможность замены компонентов

### 2. Обработка ошибок
- Try-except блоки
- QMessageBox для пользователя
- Логирование в статус-бар

### 3. Валидация данных
- Проверка заполненности полей
- Валидация цен (диапазон)
- Подтверждение удаления

### 4. Производительность
- Индексы в БД
- Эффективные SQL запросы
- Кэширование результатов UI

### 5. UX/UI
- Интуитивный интерфейс
- Фильтры и сортировка
- Экспорт результатов
- Сравнение препаратов

## Расширение функциональности

### Возможные улучшения

1. **Сетевая функциональность**:
   - Импорт данных из API
   - Синхронизация с центральной БД

2. **Расширенная аналитика**:
   - Графики цен
   - Статистика по производителям
   - История изменений

3. **Уведомления**:
   - Низкая цена
   - Новые аналоги
   - Изменение наличия

4. **Интеграция**:
   - Экспорт в Excel
   - Печать результатов
   - QR-коды препаратов

5. **Локализация**:
   - Мультиязычность
   - Английский интерфейс

## Документация

- **README.md** - общая информация
- **PROJECT_STRUCTURE.md** - структура проекта
- **Докстринги** - в каждом модуле
- **Комментарии** - важные части кода

## Тестирование

### Запуск тестов
```bash
# Все тесты
python -m unittest discover tests

# Конкретный файл
python -m unittest tests.test_search_engine

# С verbose
python -m unittest discover tests -v
```

### Покрытие (25 тестов)
- 15 тестов SearchEngine и базовых операций БД
- 10 тестов расширенного функционала БД
- Все тесты проходят успешно ✅

## Лицензия и авторство

Проект создан в учебных целях для демонстрации навыков разработки настольных приложений на Python с использованием PyQt5 и SQLite.

